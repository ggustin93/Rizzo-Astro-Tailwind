---
import { getEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { Calendar, Mail, Phone } from 'astro-feather-icons';
import IconWhatsapp from '../../components/IconWhatsApp.astro';
import IconLinkedin from '../../components/IconLinkedIn.astro';
import IconGoogleMaps from '../../components/IconGmaps.astro';
import { Image } from 'astro:assets';
import ctaIllustration from '../../assets/images/illustration_cta_2.svg';

export async function getStaticPaths() {
  return ['fr', 'en', 'it'].map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params;
const contactEntry = await getEntry('contact', 'contact');
const contactData = contactEntry.data[lang];

const iconComponents = {
  calendar: Calendar,
  mail: Mail,
  phone: Phone,
  'message-circle': IconWhatsapp,
  linkedin: IconLinkedin,
  'map-pin': IconGoogleMaps
};

const handleAction = (type: string, action: string) => {
  switch(type) {
    case 'calendly':
      return `window.Calendly.showPopupWidget('${action}')`;
    case 'email':
      return `window.location.href = 'mailto:${action}'`;
    case 'phone':
      return `window.location.href = 'tel:${action}'`;
    case 'whatsapp':
      return `window.open('https://wa.me/${action.replace(/\D/g,'')}', '_blank')`;
    case 'linkedin':
      return `window.open('${action}', '_blank')`;
    case 'maps':
      return `window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(action)}', '_blank')`;
    default:
      return '';
  }
};
---

<BaseLayout title={`${contactData.title} - Christine Rizzo`} lang={lang} description={contactData.title}>
  <main class="container mx-auto px-4 py-16">
    <h1 class="text-4xl font-light mb-12 text-black text-center">{contactData.heading}</h1>
    
    <div class="full-bleed bg-employeur py-16">
      <div class="container mx-auto px-4">
        <div class="flex flex-col lg:flex-row gap-8 items-start">
          <div class="w-full lg:w-2/3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            {contactData.buttons.map((button) => {
              const IconComponent = iconComponents[button.icon];
              return (
                <div class="flex flex-col items-center">
                  <button
                    onclick={handleAction(button.type, button.action || button.subtext)}
                    class="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-4 hover:bg-travailleur transition-colors duration-300 group shadow-md"
                  >
                    <IconComponent class="w-12 h-12 text-employeur group-hover:text-white transition-colors duration-300" />
                  </button>
                  <span class="text-sm uppercase text-accent font-extrabold leading-relaxed tracking-wide mb-2 px-2 text-center">{button.text}</span>
                  <a href="#" class="text-sm text-white hover:underline font-medium text-center">{button.subtext}</a>
                </div>
              );
            })}
          </div>
          <div class="w-full lg:w-1/3 flex justify-center lg:justify-end">
            <Image
              src={ctaIllustration}
              alt="illustration contact"
              class="w-full h-auto max-w-sm lg:max-w-full"
              width={400}
              height={400}
              loading="lazy"
              format="avif"
            />
          </div>
        </div>
      </div>
    </div>
  </main>
</BaseLayout>

<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
<script is:inline src="https://assets.calendly.com/assets/external/widget.js"></script>
<script>
  document.addEventListener('astro:page-load', () => {
    window.Calendly.initBadgeWidget({
      url: 'https://calendly.com/decarbonaction/meeting',
      text: 'Planifier du temps avec moi',
      color: '#0069ff',
      textColor: '#ffffff',
      branding: undefined
    });
  });
</script>